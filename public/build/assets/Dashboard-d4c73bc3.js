import{r as l,_ as he,j as a,a as t,N as T,b as pe}from"./app-c94b149d.js";import{A as fe}from"./AuthenticatedLayout-9ad1a5eb.js";import{B as v}from"./button.esm-320d2b12.js";import{T as L}from"./tag.esm-9b7b2b3e.js";import{D as $}from"./dialog.esm-f5d0781d.js";import{I as M}from"./inputnumber.esm-ef9748de.js";import"./ApplicationLogo-0b73b480.js";import"./transition-4f2656b9.js";import"./portal.esm-105fa917.js";import"./csstransition.esm-de611294.js";import"./inputtext.esm-a242d243.js";T.configure({showSpinner:!1});function Ie(d){const[S,F]=l.useState([]);l.useState("grid");const[r,K]=l.useState({}),[U,O]=l.useState(!1),[n,y]=l.useState([]),[i,x]=l.useState(0),[h,u]=l.useState(!1),[c,B]=l.useState(0),[b,J]=l.useState(null),[z,C]=l.useState(!1),[N,g]=l.useState(null),[p,P]=l.useState(null),{data:ye,setData:G,post:xe,reset:be,processing:Ne,errors:ge}=he(JSON.parse(localStorage.getItem("items"))),w=new Set,R=d.product_types.filter(e=>{const s=e.name.trim().toLowerCase();return s!==""&&!w.has(s)?(w.add(s),!0):!1}),V=d.product_types.filter(e=>{const s=e.type.trim().toLowerCase();return s!==""&&!w.has(s)?(w.add(s),!0):!1});l.useEffect(()=>{F(d.all_products)},[]);const _=["In Stock","Low Stock","Out of Stock"],k=e=>e.quantity>5?"success":e.quantity<=5&&e.quantity>=1?"warning":"danger",W=e=>{K(e),O(!0)},[X,q]=l.useState(null),[Y,j]=l.useState(null),Z=()=>{u(!0);let e=!1,s=null,m=null,E=null,H={image:r.product_image,name:r.product_name,quantity:i,subtotal:i*r.price,product_id:r.id,product_type_name:X,selection:Y};console.log(H),i&&i>0&&(n.forEach((o,f)=>{o.product_id===r.id&&(e=!0,s=f,m=i+o.quantity,E=m*r.price)}),S.forEach(o=>{o.id===r.id&&(o.quantity-=i)}),y(e?o=>{const f=[...o];return f[s]={...f[s],quantity:m,subtotal:E},f}:[...n,H]),u(!1),O(!1),x(0),q(null),j(null),Q(0),I(0))};l.useEffect(()=>{let e=0;n.forEach(s=>{e+=s.subtotal}),B(e)});const D=e=>{let s=n[e];console.log(s),S.forEach(m=>{m.id===s.product_id&&(m.quantity+=s.quantity)}),y([...n.slice(0,e),...n.slice(e+1)])},ee=()=>{O(!1),x(0),u(!1)},te=()=>{let e="vpm-"+Math.random().toString(36).slice(2);J(e),C(!0),G("orders",n)},ae=()=>{C(!1),P(null),g(null),u(!1)},se=e=>{P(e),e-c>=0?g(e-c):g(null)},le=async e=>{if(e.preventDefault(),T.start(),u(!0),localStorage.setItem("items",JSON.stringify({orders:n,order_details:{total_amount:c,order_number:b,cash:p,change:N},user_id:d.auth.user.id})),n&&c&&b)try{await pe.post(route("orders.store"),{orders:n,order_details:{total_amount:c,order_number:b,cash:p,change:N},user_id:d.auth.user.id}),C(!1),P(null),g(null),u(!1),y([])}catch{}finally{T.done()}},[re,I]=l.useState(0),[ne,A]=l.useState(null),ie=e=>{I(e.id),q(e.name),e.name.toLowerCase()=="juice"?A(d.product_types.filter(s=>s)):A(null)},[de,Q]=l.useState(0),ce=e=>{Q(e.id),j(e.type)},[oe,we]=l.useState(!1),ue=e=>{let s=e.quantity;i<s&&x(i+1)},me=()=>{i>0&&x(i-1)};return a(fe,{auth:d.auth,errors:d.errors,header:t("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Orders Dashboard"}),children:[a("div",{class:"container px-6 mx-auto grid",children:[t("h2",{class:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200",children:"Orders Dashboard"}),a("div",{className:"flex justify-between dashboard-main-style",children:[t("div",{className:"flex flex-wrap gap-4",children:S.map(e=>a("div",{className:"flex dashboard-product-card flex-col pb-2 bg-stone-100 shadow-md rounded border-gray-900 items-center gap-3 py-5 p-2",children:[t(L,{value:e.quantity>5?_[0]:e.quantity<=5&&e.quantity>=1?_[1]:_[2],className:"self-start",severity:k(e)}),a("div",{children:[t("img",{className:"w-full shadow-2 rounded",src:`http://127.0.0.1:8000/uploads/products/${e.product_image}`,alt:e.product_name}),t("div",{className:"text-md font-bold p-2",children:e.product_name})]}),a("div",{className:"flex w-full items-center justify-between p-2",children:[a("div",{className:"flex flex-col gap-3",children:[a("p",{className:"flex flex-col",children:[t("span",{className:"text-sm font-bold",children:"Price"}),t("span",{className:"text-xs ",children:e.price.toLocaleString("en-PH",{style:"currency",currency:"PHP"})})]}),a("p",{className:"flex flex-col",children:[t("span",{className:"text-sm font-bold",children:"Qty"}),t("span",{className:"text-xs ",children:e.quantity})]})]}),t(v,{icon:"pi pi-shopping-cart",style:{height:"2rem",width:"2rem"},className:"p-button-rounded text-sm w-4 h-4",onClick:()=>W(e),disabled:e.quantity===0})]})]}))}),a("div",{className:"bg-stone-300 rounded p-5",children:[a("header",{className:"flex justify-between",children:[t("h4",{children:"Orders"}),t("p",{children:"Subtotal"})]}),t("hr",{}),n.length>0&&a("main",{className:"py-4",children:[n.map((e,s)=>a("div",{children:[a("div",{className:"flex flex-row align-end justify-between py-2",style:{position:"relative"},children:[a("div",{children:[t("img",{className:"w-24 shadow-2 rounded",src:`http://127.0.0.1:8000/uploads/products/${e.image}`,alt:e.name}),t("p",{className:"font-bold",children:e.name})]}),a("div",{className:"self-end",children:[t("i",{className:"pi pi-times",onClick:()=>D(s),style:{color:"red",position:"absolute",top:"10px",right:0}}),t("p",{className:"text-end font-bold",children:e.subtotal.toLocaleString("en-PH",{style:"currency",currency:"PHP"})}),a("p",{className:"text-end",children:["Qty: ",e.quantity]})]})]}),t("hr",{})]})),a("div",{className:"flex justify-between py-5",children:[t("h4",{children:"Total:"}),t("p",{className:"text-end font-bold",children:c.toLocaleString("en-PH",{style:"currency",currency:"PHP"})})]}),t(v,{style:{"justify-content":"center",width:"100%"},className:"text-center",disabled:r.inventoryStatus==="OUTOFSTOCK",onClick:()=>te(),children:"Pay"})]}),n.length==0&&t("p",{className:"py-3",children:"No orders added."})]})]})]}),t($,{visible:U,style:{width:"30rem"},breakpoints:{"960px":"75vw","641px":"90vw"},header:r.name,modal:!0,className:"p-fluid",onHide:()=>ee(),children:a("div",{className:"flex flex-col pb-2 bg-stone-100 shadow-md rounded border-gray-900 items-center gap-3 py-5 p-2",children:[t(L,{value:r.status,className:"self-start",severity:k(r)}),t("div",{className:"w-full",children:t("img",{className:"w-full shadow-2 rounded",src:`http://127.0.0.1:8000/uploads/products/${r.product_image}`,alt:r.name})}),a("div",{className:"flex flex-col gap-3 w-full items-start justify-between p-2",children:[a("div",{className:"flex w-full flex-col self-start",children:[t("span",{className:"text-md font-bold",children:"Quatity"}),a("div",{className:"flex justify-between my-5",children:[t("i",{className:"pi pi-minus",style:{color:"slateblue"},onClick:e=>me()}),t("p",{children:i}),t("i",{className:"pi pi-plus",style:{color:"slateblue"},onClick:e=>ue(r)})]}),h&&i==0&&t("span",{className:"text-red-500 text-xs py-2",children:"Quantity is required!"}),h&&i<=0&&t("span",{className:"text-red-500 text-xs py-2",children:"Quantity must greater than 0 !"}),oe&&t("span",{className:"text-red-500 text-xs py-2",children:"Not enough product from inventory!"})]}),a("div",{className:"field mb-5",children:[t("label",{htmlFor:"email",className:"font-bold mb-3",children:"Product Type"}),t("br",{}),R.map(e=>e.name!==""&&t("button",{className:`mt-4 mr-2 bg-blue-800 px-4 py-1 ${re===e.id?"selected":""} text-white rounded`,onClick:s=>ie(e),children:e.name})),t("br",{}),ne!==null&&V.map(e=>e.type!==""&&t("button",{className:`mt-4 mr-2 bg-blue-800 px-4 py-1 ${de===e.id?"selected":""} text-white rounded`,onClick:s=>ce(e),children:e.type}))]}),t(v,{style:{"justify-content":"center"},className:"text-center",disabled:r.inventoryStatus==="OUTOFSTOCK",onClick:()=>Z(),children:"Add"})]})]})}),t($,{visible:z,style:{width:"30rem"},breakpoints:{"960px":"75vw","641px":"90vw"},header:"Checkout Orders",modal:!0,className:"p-fluid",onHide:()=>ae(),children:a("div",{className:"flex flex-col pb-2 bg-stone-100 shadow-md rounded border-gray-900 items-center gap-3 py-5 p-2",children:[a("div",{className:"flex flex-col gap-3 w-full items-center justify-between p-2",children:[a("header",{className:"flex w-full justify-between",children:[t("h4",{children:"Orders"}),t("p",{children:"Subtotal"})]}),t("hr",{}),n.length>0&&a("main",{className:"py-4 w-full",children:[n.map((e,s)=>a("div",{children:[a("div",{className:"flex flex-row align-end justify-between py-2",style:{position:"relative"},children:[a("div",{children:[t("img",{className:"w-24 shadow-2 rounded",src:`http://127.0.0.1:8000/uploads/products/${e.image}`,alt:e.name}),t("p",{className:"font-bold",children:e.name})]}),a("div",{className:"self-end",children:[t("i",{className:"pi pi-times",onClick:()=>D(s),style:{color:"red",position:"absolute",top:"10px",right:0}}),a("p",{className:"text-end font-bold",children:["₱ ",e.subtotal,".00"]}),a("p",{className:"text-end",children:["Qty: ",e.quantity]})]})]}),t("hr",{})]})),a("div",{className:"flex justify-between py-5",children:[t("h4",{children:"Total:"}),a("p",{className:"text-end font-bold",children:["₱ ",c,".00"]})]})]})]}),a("div",{className:"flex flex-col gap-3 w-full items-center justify-between p-2",children:[a("div",{className:"w-full",children:[t("h5",{className:"text-xl font-bold",children:b}),t("span",{className:" mb-3",children:"Orde Number"})]}),a("div",{className:"flex w-full flex-col self-start",children:[t("span",{className:"text-md font-bold",children:"Cash Amount"}),t(M,{value:p,onChange:e=>se(e.value)}),h&&p==null&&t("span",{className:"text-red-500 text-xs py-2",children:"Cash Amount is required!"}),h&&p<=0&&t("span",{className:"text-red-500 text-xs py-2",children:"Cash Amount must greater than 0 !"})]}),a("div",{className:"flex w-full flex-col self-start",children:[t("span",{className:"text-md font-bold",children:"Change"}),t(M,{value:N,disabled:!0}),h&&N==null&&t("span",{className:"text-red-500 text-xs py-2",children:"Cash Amount is not enough!"})]}),t(v,{style:{"justify-content":"center"},className:"text-center",disabled:r.inventoryStatus==="OUTOFSTOCK",onClick:e=>le(e),children:"Pay"})]})]})})]})}export{Ie as default};
